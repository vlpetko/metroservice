<template>    <div class="container">        <router-view></router-view>        <b-jumbotron class="creator">            <template>                <div class="creator_main">                    <b-overlay :show="busy" rounded="lg" opacity="0.6" z-index="40">                        <template #overlay>                            <div class="d-flex align-items-center">                                <b-spinner small type="grow" variant="secondary"></b-spinner>                                <b-spinner type="grow" variant="dark"></b-spinner>                                <b-spinner small type="grow" variant="secondary"></b-spinner>                                <!-- We add an SR only text for screen readers -->                                <span class="sr-only">Please wait...</span>                            </div>                        </template>                        <b-row class="creator_title">                            <b-col>                                <strong>Редактор линий и станций</strong>                            </b-col>                        </b-row>                        <b-card>                            <b-row class="creator_row">                                <b-col sm="12">                                    <label>Наименование линии</label>                                    <b-form-input id="input-1"                                                  v-model="lineName"                                                  type="string"                                                  placeholder="Введите наименовании линии"                                                  :value="getLine"                                                  trim                                    >                                    </b-form-input>                                </b-col>                            </b-row>                            <b-row class="creator_row">                                <b-col sm="12">                                    <label>Протяженность линии, км</label>                                    <b-form-input id="input-2"                                                  v-model="lineLength"                                                  type="number"                                                  placeholder="Введите протяженность линии"                                    >                                    </b-form-input>                                </b-col>                            </b-row>                            <b-row class="creator_row">                                <b-col sm="12">                                    <label>Количество единиц подвижного состава, шт</label>                                    <b-form-input id="input-3"                                                  v-model="numberOfCarriages"                                                  type="number"                                                  placeholder="Введите количество"                                    >                                    </b-form-input>                                </b-col>                            </b-row>                            <b-row class="creator_row">                                <b-col sm="7 justify-content-start d-flex">                                    <div v-if="!getListStations.length">                                        <b-button class="add_btn"                                                  @click="addNewMetroStation"                                                  variant="outline-dark"                                                  size="lg"                                                  :disabled="disableSaveState"                                                  ref="entry">                                            Добавить станцию...                                            <b-icon icon="flag" font-scale="1.2" shift-v="-1" shift-h="2"></b-icon>                                        </b-button>                                    </div>                                </b-col>                                <b-col sm="5 justify-content-end d-flex">                                    <b-button class="save_btn"                                              @click="clearAllInputs"                                              variant="outline-primary"                                              size="lg"                                              ref="entry">                                        Очистить                                        <b-icon icon="backspace" font-scale="1.2" shift-v="-1" shift-h="2"></b-icon>                                    </b-button>                                    <b-button class="save_btn"                                              @click="saveNewMetroLine"                                              variant="outline-primary"                                              size="lg"                                              :disabled="disableSaveState"                                              ref="entry">                                        Сохранить                                        <b-icon icon="file-check" font-scale="1.2" shift-v="-1" shift-h="2"></b-icon>                                    </b-button>                                </b-col>                            </b-row>                        </b-card>                        <b-row class="creator_row">                        </b-row>                        <b-card v-if="getListStations.length">                            <label>Станции линии</label>                            <b-table                                    id="line-table"                                    class="b_table"                                    ref="selectableTable"                                    selectable                                    :select-mode="selectMode"                                    :items="getListStations"                                    :fields="stationFields"                                    :bordered="true"                                    responsive="sm"                                    thead-class="bg-light"                                    @row-selected="onRowSelected"                            >                                <template #cell(id)="data">                                            <span class="selected">                                            {{  data.index + 1 }}                                                 </span>                                </template>                                <template #cell(year)="data">                                            <span class="selected">                                            {{  moment(data.item.year).format('YYYY') }}                                                 </span>                                </template>                            </b-table>                            <b-row class="creator_row">                                <b-col sm="4 justify-content-start d-flex">                                    <div v-if="getListStations.length">                                        <b-button class="add_btn"                                                  @click="addNewMetroStation"                                                  variant="outline-dark"                                                  size="lg"                                                  :disabled="disableSaveState"                                                  ref="entry">                                            Добавить станцию...                                            <b-icon icon="flag" font-scale="1.2" shift-v="-1" shift-h="2"></b-icon>                                        </b-button>                                    </div>                                </b-col>                                <b-col sm="8 justify-content-end d-flex">                                    <div v-if="getListStations.length">                                        <b-button class="del_btn"                                                  @click="deleteAddedStation"                                                  variant="outline-dark"                                                  size="lg"                                                  :disabled="disableDeleteStation"                                                  ref="entry">                                            Удалить станцию                                            <b-icon icon="trash" font-scale="1.2" shift-v="-1" shift-h="2"></b-icon>                                        </b-button>                                    </div>                                </b-col>                            </b-row>                        </b-card>                    </b-overlay>                </div>            </template>        </b-jumbotron>        <div>            <b-modal id="bv-modal-station" size="lg" hide-footer :no-close-on-backdrop="true">                <template v-slot:modal-title>                    Добавить новую станцию                </template>                <div class="station_modal">                    <b-container>                        <b-row class="creator_row">                            <b-col sm="3" align-v="end">                                <label>Наименование станции</label>                            </b-col>                            <b-col sm="9">                                <b-form-input                                        id="input-live-name"                                        v-model="nameOfStation"                                        placeholder="Введите наименование"                                ></b-form-input>                            </b-col>                        </b-row>                        <b-row class="creator_row">                            <b-col sm="3" align-v="end">                                <label>Вошедшие пассажиры</label>                            </b-col>                            <b-col sm="9">                                <b-form-input                                        id="input-live-incoming"                                        v-model="incomingPassengers"                                        placeholder="Введите количество"                                        type="number"                                ></b-form-input>                            </b-col>                        </b-row>                        <b-row class="creator_row">                            <b-col sm="3" align-v="end">                                <label>Вышедшие пассажиры</label>                            </b-col>                            <b-col sm="9">                                <b-form-input                                        id="input-live-outgoing"                                        v-model="outgoingPassengers"                                        placeholder="Введите количество"                                        type="number"                                ></b-form-input>                            </b-col>                        </b-row>                        <b-row class="creator_row">                            <b-col sm="3" align-v="end">                                <label>Год оценки пассажиропотока</label>                            </b-col>                            <b-col sm="9">                                        <b-form-input                                                id="input-live-year"                                                v-model="year"                                                type="number"                                                :state="yearState"                                                placeholder="Укажите год"                                                aria-describedby="input-live-year input-live-year-feedback"                                        ></b-form-input>                                        <b-form-invalid-feedback id="input-live-year-feedback">                                            Год должен быть заполнен в формате ГГГГ!                                        </b-form-invalid-feedback>                            </b-col>                        </b-row>                        <b-row class="creator_row">                            <b-col sm="3" align-v="end">                                <label>Квартал оценки пассажиропотока</label>                            </b-col>                            <b-col sm="9">                                <b-form-input                                        v-model="quarter"                                        placeholder="Выберите квартал"                                        list="quarters-list"                                ></b-form-input>                                <b-form-datalist id="quarters-list" :options="quartersList">                                </b-form-datalist>                            </b-col>                        </b-row>                    </b-container>                </div>                <b-row>                    <b-col lg="3">                    </b-col>                    <b-col>                    </b-col>                    <b-col lg="5">                        <b-button class="station_sh_btn"                                  @click="createNewStation"                                  :disabled="disableNewStation"                                  variant="outline-primary"                                  size="sm">                            Создать                        </b-button>                        <b-button class="station_sh_btn"                                  @click="$bvModal.hide('bv-modal-station')"                                  variant="outline-dark"                                  size="sm">                            Отмена                        </b-button>                    </b-col>                </b-row>            </b-modal>        </div>        <div>            <b-toast id="success-station-toast" variant="success" solid :append-toast=true>                <template v-slot:toast-title>                    <div class="d-flex flex-grow-1 align-items-baseline">                        <b-img blank blank-color="#8FBC8F" class="mr-2" width="12" height="12"></b-img>                        <strong class="mr-auto">Успешно!</strong>                    </div>                </template>                {{ this.stationMessage }}            </b-toast>        </div>        <div>            <b-toast id="success-creator-toast" variant="success" solid :append-toast=true>                <template v-slot:toast-title>                    <div class="d-flex flex-grow-1 align-items-baseline">                        <b-img blank blank-color="#8FBC8F" class="mr-2" width="12" height="12"></b-img>                        <strong class="mr-auto">Успешно!</strong>                    </div>                </template>                {{ this.creatorMessage }}            </b-toast>            <b-toast id="danger-creator-toast" variant="danger" solid :append-toast=true>                <template v-slot:toast-title>                    <div class="d-flex flex-grow-1 align-items-baseline">                        <b-img blank blank-color="#8B0000" class="mr-2" width="12" height="12"></b-img>                        <strong class="mr-auto">Ошибка!</strong>                    </div>                </template>                {{ this.creatorMessage }}            </b-toast>        </div>    </div></template><script>    import axios from 'axios'    import moment from 'moment'    export default {        computed: {            getId() {                return this.$store.state.newLine['id']            },            getLine() {                return this.$store.state.newLine['lineName']            },            getLineLength() {                return this.$store.state.newLine['lineLength']            },            getNumberOfCarriages() {                return this.$store.state.newLine['numberOfCarriages']            },            disableSaveState() {                if(this.lineName) {                    if (this.lineName.length !== 0 && this.lineLength.length !== 0 && this.numberOfCarriages.length !== 0) {                        return false                    }                }                    return true            },            disableNewStation() {                if(this.lineName) {                    if (this.nameOfStation.length !== 0 && this.incomingPassengers.length !== 0                        && this.outgoingPassengers.length !== 0 && this.year.length !== 0) {                        return false                    }            }                return true            },            getListStations() {                return this.$store.state.listStations;            },            yearState() {                return this.year.length === 4 && this.year.startsWith('20')            },        },        components: {},        name: 'CurrentLine',        watch: {            $route: {                immediate: true,                handler(to) {                    document.title = to.meta.title || 'MosMetro';                },            },        },        data() {            return {                currentLine: '',                busy: false,                id: '',                lineName: '',                lineLength: '',                numberOfCarriages: '',                nameOfStation: '',                incomingPassengers: '',                outgoingPassengers: '',                year: '',                newStations: [],                stationFields: [                    {key: 'id', label: "№"},                    {key: 'nameOfStation', label: 'Наименование станции', sortable: true},                    {key: 'incomingPassengers', label: 'Вошедшие', sortable: true},                    {key: 'outgoingPassengers', label: 'Вышедшие', sortable: true},                    {key: 'year', label: 'Год', sortable: true},                    {key: 'quarter', label: 'Квартал', sortable: true},                ],                disableDeleteStation: true,                rowSelected:'',                quarter:'',                quartersList: [                    'I квартал',                    'II квартал',                    'III квартал',                    'IV квартал'                ],                creatorMessage: '',                stationMessage: '',                items: [],                metroStations: [],                selectMode: 'single',            };        },        methods: {            updateListStations(value) {                this.$store.commit('updateListStations', value);            },            updateNewLine(value) {                this.$store.commit('updateNewLine', value);            },            deleteFromListStations(value) {                this.$store.commit('deleteFromListStations', value);            },            clearLineAndListStations() {                this.$store.commit('clearLineAndListStations');                this.clearAllInputs()            },            setListStations(value) {                this.$store.commit('setListStations', value);            },            updateLineState() {                if(this.$route.params.Pid !== 0) {                    this.id = this.getId                    this.lineName = this.getLine                    this.lineLength = this.getLineLength                    this.numberOfCarriages = this.getNumberOfCarriages                }            },            saveNewMetroLine() {                this.busy = true;                axios.post('/api/api/editor/create',                    {                        id: this.id === '' ? null : this.id,                        lineName: this.lineName,                        metroLineLength: this.lineLength,                        numberOfCarriages: this.numberOfCarriages,                        numberOfStations: this.$store.state.listStations.length,                        metroStations: this.$store.state.listStations,                    },                ).then(response => {                    if (response.data.length !== 0) {                        this.creatorMessage = "Новая линия создана!";                        this.$bvToast.show('success-creator-toast');                    }                }).catch(() => {                    this.creatorMessage = "Не удалось создать новую линию!";                    this.$bvToast.show('danger-creator-toast')                }).finally(() => {                    this.creatorMessage = ''                    this.lineName = ''                    this.lineLength = ''                    this.numberOfCarriages = ''                    this.clearLineAndListStations()                    this.busy = false;                    this.$router.push('/main')                })            },            addNewMetroStation() {                this.$bvModal.show('bv-modal-station');            },            createNewStation() {                let addedStation = {                    nameOfStation: this.nameOfStation,                    incomingPassengers: this.incomingPassengers,                    outgoingPassengers: this.outgoingPassengers,                    year: moment(this.year + "-01-01").format('YYYY-MM-DD'),                    quarter: this.convertQuarterToInt(),                }                let addedLine = {                    lineName: this.lineName,                    lineLength: this.lineLength,                    numberOfCarriages: this.numberOfCarriages,                }                this.updateListStations(addedStation);                this.updateNewLine(addedLine)                this.stationMessage = "Новая станция добавлена!";                this.$bvToast.show('success-station-toast');                this.nameOfStation = ''                this.incomingPassengers = ''                this.outgoingPassengers = ''                this.year = ''                this.quarter = ''            },            convertQuarterToInt() {                let intQuarter = ''                if (this.quarter === 'I квартал') {                    intQuarter = 1                } else if(this.quarter === 'II квартал') {                    intQuarter = 2                } else if(this.quarter === 'III квартал') {                    intQuarter = 3                } else if(this.quarter === 'IV квартал') {                    intQuarter = 4                }                return intQuarter            },            deleteAddedStation() {                let name = this.rowSelected["nameOfStation"]                let incomingPassengers = this.rowSelected["incomingPassengers"]                let value = {name, incomingPassengers}                this.deleteFromListStations(value)                this.stationMessage = "Cтанция удалена!";                this.$bvToast.show('success-station-toast');            },            onRowSelected(items) {                this.selected = items                this.rowSelected = this.selected[0]                if (this.selected.length === 0) {                    this.disableDeleteStation = true                } else {                    this.disableDeleteStation = false                }            },            clearAllInputs() {                this.$store.state.listStations = []                this.$store.state.newLine = {}                this.updateLineState()            },            getLineWithStationsById() {                this.busy = true;                let id = this.$route.params.Pid;                axios.get('/api/line/full/' + id,                    {                        params: {                        }                    })                    .then(response => {                        if (response.data.length !== 0) {                            this.message = "Список линий загружен"                            let addedLine = {                                id: response.data.id,                                lineName: response.data.lineName,                                lineLength: response.data.metroLineLength,                                numberOfCarriages: response.data.numberOfCarriages,                            }                            this.updateNewLine(addedLine)                            let addedStations = response.data.metroStations;                            this.setListStations(addedStations)                            this.$bvToast.show('success-toast')                        } else {                            this.message = "Список пуст"                            this.$bvToast.show('danger-toast')                        }                    }).catch(() => {                }).finally(() => {                    this.updateLineState()                    this.busy = false                })            },        },        beforeMount() {            this.clearLineAndListStations()            if(this.$route.params.Pid !== 0) {                this.getLineWithStationsById()            }        },    };    import 'bootstrap/dist/css/bootstrap.css'    import 'bootstrap-vue/dist/bootstrap-vue.css'</script><style scoped>    .creator {        font-family: Arial;        margin: 30px 10px 20px 10px;        font-size: 28px;        text-align: center;    }    .creator_main {        margin: 10px 10px 50px 10px;        font-size: large;    }    .creator_title {        margin: 0px 0px 50px 0px;        font-size: larger;        text-align: center;    }    .creator_row {        margin: 10px 10px 20px 10px;        font-size: large;    }    .save_btn {        margin: 10px 0 0 10px;        text-align: center;        width: 140px;        font-size: medium;    }    .del_btn {        margin: 10px 0 0 10px;        text-align: center;        width: 220px;        font-size: medium;    }    .add_btn {        margin: 10px 0 0 0;        text-align: center;        width: 220px;        font-size: medium;    }    .station_modal {        margin: 10px 10px 0 10px;        font-size: 14px;    }    .station_sh_btn {        margin: 10px 0 0 30px;        text-align: center;        width: 100px;        font-size: 14px;    }    .b_table {        text-align: center;        font-size: smaller;    }    .selected {        text-align: center;    }    /deep/ .table > tbody > tr.b-table-row-selected > td,    /deep/ .table > tbody > tr.b-table-row-selected > th {        background-color: #DCEDFC;        border: 2px solid #8797A5;    }    /deep/ .table > tbody > tr,    /deep/ .table > tbody > tr > td,    /deep/ .table > tbody > tr > th {        background-color: white;        border: 1px solid #8797A5;    }    /deep/ .table > thead > tr,    /deep/ .table > thead > tr > td,    /deep/ .table > thead > tr > th {        background-color: white;        border: 2px solid #8797A5;    }</style>